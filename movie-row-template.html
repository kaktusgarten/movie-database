<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Moviecard Einzeiler - Tooltip Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Tooltip Grundstil - kein @apply, reines CSS (läuft im Browser) */
      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip-content {
        display: none; /* wichtig: standardmäßig verstecken */
        position: absolute;
        bottom: calc(100% + 8px); /* oberhalb des Buttons */
        left: 50%;
        transform: translateX(-50%) translateY(6px);
        width: 20rem; /* 320px */
        max-width: calc(100vw - 40px);
        background: #ffffff;
        color: #1f2937;
        font-size: 0.875rem;
        line-height: 1.2;
        padding: 0.6rem 0.75rem;
        border-radius: 0.5rem;
        box-shadow: 0 10px 20px rgba(2, 6, 23, 0.15);
        border: 1px solid rgba(0, 0, 0, 0.06);
        z-index: 60;
        opacity: 0;
        pointer-events: none;
        transition: opacity 160ms ease, transform 160ms ease;
        word-break: break-word;
      }

      .tooltip-content::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border-width: 7px;
        border-style: solid;
        border-color: #ffffff transparent transparent transparent;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.08));
      }

      /* Wenn Tooltip sichtbar ist */
      .tooltip.show .tooltip-content {
        display: block;
        opacity: 1;
        pointer-events: auto;
        transform: translateX(-50%) translateY(0);
      }
    </style>
  </head>
  <body class="bg-gray-100 p-6">
    <div id="movie-list" class="space-y-4"></div>

    <script>
      // Template Funktion
      function renderMovie(movie) {
        return `
        <div
          class="movie-row flex items-center gap-4 rounded-xl px-4 py-2 h-[100px] 
                 bg-gradient-to-r from-gray-100 to-gray-200 
                 hover:from-gray-200 hover:to-gray-300 
                 transition-all duration-300 shadow-sm hover:shadow-lg 
                 transform hover:-translate-y-1 overflow-visible"
        >
          <!-- Thumbnail -->
          <img src="${escapeHtml(movie.thumbnail)}" alt="Poster"
               class="w-[70px] h-[90px] object-cover rounded-md shadow" />

          <!-- Inhalte -->
          <div class="flex items-center gap-4 flex-1 text-sm">
            <span class="font-bold text-gray-900 truncate max-w-[180px]">${escapeHtml(
              movie.title
            )}</span>
            <span class="text-gray-600">${escapeHtml(movie.genre)}</span>
            <span class="text-gray-600">${escapeHtml(movie.release)}</span>
            <span class="text-gray-600">${escapeHtml(movie.language)}</span>
            <span class="text-gray-600">${escapeHtml(movie.runtime)}</span>

            <button class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700">
              mehr Details
            </button>

            <div class="flex gap-1">
              <button class="px-2 py-1 bg-gray-800 text-white rounded-md hover:bg-gray-700 text-xs">DE</button>
              <button class="px-2 py-1 bg-gray-800 text-white rounded-md hover:bg-gray-700 text-xs">EN</button>
            </div>

            <img src="${escapeHtml(movie.fsk)}" alt="FSK"
                 class="w-10 h-10 object-contain" />

            <!-- Tooltip: Filminhalt -->
            <div class="tooltip">
              <button
                aria-expanded="false"
                onclick="toggleTooltip(this)"
                class="px-3 py-1 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"
              >
                Filminhalt
              </button>
              <div class="tooltip-content">
                <p class="text-sm text-gray-700 mb-2">${escapeHtml(
                  movie.description
                )}</p>
                <a href="${escapeHtml(
                  movie.moreLink || "#"
                )}" class="text-blue-600 underline text-sm">mehr</a>
              </div>
            </div>

            <button class="px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700">
              Zur Watchlist
            </button>
            <button class="px-3 py-1 bg-black text-white rounded-md hover:bg-gray-800">
              Bereits gesehen
            </button>
            <button class="px-3 py-1 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
              Notiz
            </button>
          </div>
        </div>
      `;
      }

      // kleine Escaping-Hilfe (verhindert XSS bei dynamischen Inhalten)
      function escapeHtml(str) {
        if (!str && str !== 0) return "";
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      // Tooltip-Logik: schließt zuerst alle anderen Tooltips, toggled dann den aktuellen
      function toggleTooltip(button) {
        const tooltip = button.parentElement;
        const wasOpen = tooltip.classList.contains("show");

        // Alle anderen schließen
        document.querySelectorAll(".tooltip.show").forEach((t) => {
          t.classList.remove("show");
          const btn = t.querySelector("button[aria-expanded]");
          if (btn) btn.setAttribute("aria-expanded", "false");
        });

        if (!wasOpen) {
          tooltip.classList.add("show");
          button.setAttribute("aria-expanded", "true");
        } else {
          tooltip.classList.remove("show");
          button.setAttribute("aria-expanded", "false");
        }
      }

      // Klick außerhalb schließt offene Tooltips
      document.addEventListener("click", (e) => {
        document.querySelectorAll(".tooltip.show").forEach((t) => {
          if (!t.contains(e.target)) {
            t.classList.remove("show");
            const btn = t.querySelector("button[aria-expanded]");
            if (btn) btn.setAttribute("aria-expanded", "false");
          }
        });
      });

      // Beispiel-Daten
      const movies = [
        {
          title: "Star Wars op Kölch",
          genre: "SciFi",
          release: "22.08.2015",
          language: "deutsch, englisch",
          runtime: "207 Min",
          thumbnail:
            "https://tse2.mm.bing.net/th/id/OIP.9kHjYBavvuQxkHvsLmk1DAHaLP?r=0&rs=1&pid=ImgDetMain&o=7&rm=3",
          fsk: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/FSK_12.svg/120px-FSK_12.svg.png",
          description:
            "Ein epischer SciFi-Film mit großen Raumschlachten und Humor.",
          moreLink: "#",
        },
        {
          title: "Herr der Ringe",
          genre: "Fantasy",
          release: "19.12.2001",
          language: "deutsch, englisch",
          runtime: "178 Min",
          thumbnail:
            "https://upload.wikimedia.org/wikipedia/en/8/87/Ringstrilogyposter.jpg",
          fsk: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/FSK_6.svg/120px-FSK_6.svg.png",
          description:
            "Ein Hobbit begibt sich auf eine epische Reise, um einen Ring zu zerstören.",
          moreLink: "#",
        },
      ];

      // Render Movies
      const movieList = document.getElementById("movie-list");
      movies.forEach((m) =>
        movieList.insertAdjacentHTML("beforeend", renderMovie(m))
      );
    </script>
  </body>
</html>
